{% extends "base.html" %}
{% block body %}
    <main class="container">
        <section>
            <h1>{{ vehicle.name }}</h1>
            {% if defect_created %}<p>Anomalie créée !</p>{% endif %}
            {% if trip_edited %}<p>Trajet mis à jour !</p>{% endif %}
            <table>
                <tbody>
                <tr>
                    <td>Type</td>
                    <td>{{ vehicle.type }}</td>
                </tr>
                <tr>
                    <td>Statut</td>
                    <td>{{ vehicle.get_status_display }}</td>
                </tr>
                <tr>
                    <td>Carburant</td>
                    <td>{{ vehicle.get_carburant_display }}</td>
                </tr>
                <tr>
                    <td>Localisation</td>
                    <td>{{ vehicle.parking_location.address }}
                        - {{ vehicle.parking_location.zip_code }} {{ vehicle.parking_location.city }}</td>
                </tr>
                <tr>
                    <td>Kilométrage</td>
                    <td>{{ vehicle.mileage }}</td>
                </tr>
                </tbody>
            </table>
        </section>
        <details {% if trip_form.errors %}open{% endif %}>
            <summary role="button">{% if trip_started %}Finir le trajet{% else %}Commencer un trajet{% endif %}</summary>
            <section>
                <form action="{% url 'vehicle_details' vehicle.pk %}" method="post">
                    {% csrf_token %}
                    <p>{{ trip_form.non_field_errors }}</p>
                    <div class="grid">
                        <div>{{ trip_form.starting_time.label_tag }}{{ trip_form.starting_time }}{% for error in trip_form.starting_time.errors %}<small>{{ error }}</small>{% endfor %}</div>
                        <div>{{ trip_form.starting_mileage.label_tag }}{{ trip_form.starting_mileage }}{% for error in trip_form.starting_mileage.errors %}<small>{{ error }}</small>{% endfor %}</div>
                    </div>
                    <div class="grid">
                        <div>{{ trip_form.driver_name.label_tag }}{{ trip_form.driver_name }}{% for error in trip_form.driver_name.errors %}<small>{{ error }}</small>{% endfor %}</div>
                        <div>{{ trip_form.purpose.label_tag }}{{ trip_form.purpose }}{% for error in trip_form.purpose.errors %}<small>{{ error }}</small>{% endfor %}</div>
                    </div>
                    {% if trip_started %}
                    <div class="grid">
                        <div>{{ trip_form.ending_time.label_tag }}{{ trip_form.ending_time }}{% for error in trip_form.ending_time.errors %}<small>{{ error }}</small>{% endfor %}</div>
                        <div>{{ trip_form.ending_mileage.label_tag }}{{ trip_form.ending_mileage }}{% for error in trip_form.ending_mileage.errors %}<small>{{ error }}</small>{% endfor %}</div>
                    </div>
                    <input type="submit" name="end-trip-form" value="Finir">
                    {% else %}
                    <input type="submit" name="start-trip-form" value="Démarrer">
                    {% endif %}
                </form>
            </section>
        </details>
        <details>
            <summary role="button">Signaler une anomalie</summary>
            <article>{% if open_defects %}
                <details>
                    <summary>Vérifier les anomalies existantes</summary>
                    <table>
                        <thead>
                        <tr>
                            <th>Type</th>
                            <th>Commentaire</th>
                            <th>Statut</th>
                            <th>Date</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for defect in open_defects %}
                            <tr>
                                <td>{{ defect.get_type_display }}</td>
                                <td>{{ defect.comment }}</td>
                                <td>{{ defect.get_status_display }}</td>
                                <td>{{ defect.creation_date }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>

                    </table>

                </details>
            {% endif %}
                {% if defect_form.errors %}
                    <p>{{ defect_form.errors }}</p>
                {% endif %}
                <form action="{% url 'vehicle_details' vehicle.pk %}" method="post">
                    {% csrf_token %}
                    {{ defect_form.as_p }}
                    <p>
                        <label>
                            <input type="checkbox" required role="switch">
                            L'anomalie n'a pas déjà été remontée
                        </label>
                    </p>
                    <input type="submit" value="Valider" name="defect-form">
                </form>
            </article>
        </details>
    </main>
{% endblock %}